"use strict";var IIInsomniaCityPicker=function(t){this.template=$('<div class="IIInsomnia-city-picker" id="IIInsomnia_city_picker"><div class="IIInsomnia-hot-wrap"><p>热门城市</p><ul id="IIInsomnia_hot_city"></ul></div><div class="line"></div><div class="IIInsomnia-wrap"><p>选择省份</p><ul class="IIInsomnia-province-wrap" id="IIInsomnia_province_wrap"></ul></div></div>'),this.hot_city=$("#IIInsomnia_hot_city",this.template),this.province_wrap=$("#IIInsomnia_province_wrap",this.template),this.settings={data:t.data,target:$(t.target),valType:t.valType||"k",multiple:t.multiple||!1,hideProvinceInput:!!t.hideProvinceInput&&$(t.hideProvinceInput),hideCityInput:!!t.hideCityInput&&$(t.hideCityInput),callback:t.callback||""}};IIInsomniaCityPicker.prototype={init:function(){var i=this;$(window).click(function(t){i.template.remove()}),i.settings.target.attr("readonly",!0),i.targetEvent()},buildCityPicker:function(){var t=this;t.buildHotCityTpl(),t.buildProvinceTpl(),t.provinceEvent(),t.cityEvent(),t.cleanBtnEvent()},buildHotCityTpl:function(){for(var t=this.settings.data.hot,i="",n=0,e=t.length;n<e;n++)i+='<li class="IIInsomnia-hot-city" data-id="'+t[n].id+'" data-name="'+t[n].name+'" data-pid="'+t[n].pid+'" data-pname="'+t[n].pname+'">'+t[n].name+"</li>";this.hot_city.html(i)},buildProvinceTpl:function(){for(var t=this.settings.data.province,i="",n=0,e=t.length;n<e;n++)i+='<li class="IIInsomnia-province" data-id="'+t[n].id+'" data-name="'+t[n].name+'"><ul class="IIInsomnia-city-wrap"></ul><div class="IIInsomnia-province-name">'+t[n].name+"</div></li>";i+='<li class="IIInsomnia-clean"><input type="button" class="IIInsomnia-clean-btn" id="IIInsomnia_clean_btn" value="清 空"></li>',this.province_wrap.html(i)},buildCityTpl:function(t){for(var i,n=t.data("id"),e=t.position(),a=this.settings.data.province,s="",o=0,r=a.length;o<r;o++)if(a[o].id==parseInt(n)){i=a[o].city;break}for(var p=0,c=i.length;p<c;p++)s+='<li class="IIInsomnia-city" data-id="'+i[p].id+'" data-name="'+i[p].name+'" title="'+i[p].name+'">'+i[p].name+"</li>";t.find(".IIInsomnia-city-wrap").html(s).css("left","-"+(e.left-37)+"px").show()},provinceEvent:function(){var n=this;n.province_wrap.on("click",".IIInsomnia-province",function(t){t.preventDefault(),t.stopPropagation();var i=$(this);return i.hasClass("active")?(i.removeClass("active"),i.find(".IIInsomnia-province-name").removeClass("active"),i.find(".IIInsomnia-city-wrap").hide().children().remove()):(n.province_wrap.find(".IIInsomnia-province").removeClass("active"),n.province_wrap.find(".IIInsomnia-province-name").removeClass("active"),n.province_wrap.find(".IIInsomnia-city-wrap").hide().children().remove(),i.addClass("active"),i.find(".IIInsomnia-province-name").addClass("active"),n.buildCityTpl(i)),!1})},cityEvent:function(){var r=this;r.hot_city.on("click",".IIInsomnia-hot-city",function(t){t.preventDefault(),t.stopPropagation();var i,n,e=$(this),a=e.data("id"),s=e.data("name");return r.settings.target.val(s),r.settings.hideCityInput&&("k-v"==r.settings.valType?r.settings.hideCityInput.val(a+"-"+s):r.settings.hideCityInput.val(a)),r.settings.hideProvinceInput&&(i=e.data("pid"),n=e.data("pname"),"k-v"==r.settings.valType?r.settings.hideProvinceInput.val(i+"-"+n):r.settings.hideProvinceInput.val(i)),r.template.remove(),!1}),r.province_wrap.on("click",".IIInsomnia-city",function(t){t.preventDefault(),t.stopPropagation();var i,n,e,a=$(this),s=a.data("id"),o=a.data("name");return r.settings.target.val(o),r.settings.hideCityInput&&("k-v"==r.settings.valType?r.settings.hideCityInput.val(s+"-"+o):r.settings.hideCityInput.val(s)),r.settings.hideProvinceInput&&(n=(i=a.parent().parent()).data("id"),e=i.data("name"),"k-v"==r.settings.valType?r.settings.hideProvinceInput.val(n+"-"+e):r.settings.hideProvinceInput.val(n)),r.template.remove(),!1})},cleanBtnEvent:function(){var i=this;i.province_wrap.on("click","#IIInsomnia_clean_btn",function(t){return t.preventDefault(),t.stopPropagation(),i.settings.target.val(""),i.settings.hideProvinceInput&&i.settings.hideProvinceInput.val(""),i.settings.hideCityInput&&i.settings.hideCityInput.val(""),i.template.remove(),!1})},targetEvent:function(){var a=this;a.settings.target.click(function(t){t.stopPropagation();var i=$(this);a.buildCityPicker();var n=i.offset(),e=n.top+i.outerHeight()+15;return a.template.css({left:n.left,top:e}),$("body").append(a.template),!1})}};